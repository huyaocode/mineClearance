# 重构扫雷

### 待加需求

- 当一个地方已经点击了，再点的时候去让他周围 8 个点的样式变化
- 排行榜

## 设计

### 格子

属性：

- 状态
  - flag
  - query
  - none
  - clicked
- 对应的DOM
- 周围雷数量
- 是否是雷
- 位置
  - x
  - y

方法：

- 【点击时】处理点击，判断是否为雷，展示雷或者分数
- （算周围雷数/点数）查看周围 8 个点是否有雷，计算分数
- 获取周围 8 个格子
- （引爆雷）使用观察者模式 trigger 雷引爆，所有雷展示样样式；笑脸边哭脸；即时停止；禁止用户点击
- 如果点击时这个不是雷，而且周围雷数为 0，那么让周围点数为 0 的格子周围 9 个都展示出来
- （如果状态为clicked）让周围 8 个格子样式变化，方便用户检查雷的存在
-  修改格子样式

### 地雷位置的二维数组

记录雷的位置。（单例模式，每一个格子都可以去 get，但构建者的导演可以去 init）

### 雷的引爆

有一个 MineArray，如果一个被点了，那么就用观察者模式去通知所有的雷，让他们都爆了。 其中雷既是观察者，又是监听者。 他们都 listen('mineClick')事件，也都可以 trigger('minebomb')事件。而 listen 函数回将这些对象都添加到一个单例的雷数组中。

## 设计模式

- 反射
- state 模式（每个雷状态）
- 观察者模式（计分，其他雷爆炸，笑脸变化）
- 工厂模式-生成雷
- 建造者模式

### 建造者模式

根据不同的难度，使用不同的导演类，生成不同的雷图。
 - 获得新的 计步器、倒计时、笑脸（这3个单例）
 - 获得新的地雷位置二维数组（单例）
 - 获得一个新的雷区，雷区里面又分为每一行，每一行里才是一个一个的格子